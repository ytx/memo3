# memo3

Electronベースのメモアプリケーション

📖 **[日本語操作マニュアル](./MANUAL-ja.md)**

## 概要

memo3は、Claude Code で作成したメモアプリケーションです。
コードはすべてClaude Codeが書いています。私は内容をほとんど見てません。

Evernoteのデスクトップアプリが、使いにくくなってきたので、代わりになるものを作ろうとしています。
Ctrl＋Kが使えることと、メモの書き始めに、ファイル名を決める必要がないところがポイントです。
適当なフォルダへテキストファイル・マークダウンファイルをそのまま置けば使えるようにしています。

私が欲しいものを作っています。macOSで、Emacsキーバインドのみ動作確認しています。
あまり、リッチにすることは考えていませんが、要望などあれば検討します。

ここから下は、Claude Code が勝手に書いているのでやや大げさですが、
だいたい合っていると思います。

## 主な機能

### 📁 ファイルシステム管理
- **複数ワークスペース対応**: プロジェクトごとに複数のフォルダを管理
- **ワークスペース切り替え**: 左上のドロップダウンからワンクリックで切り替え
- **独立セッション管理**: 各ワークスペースで開いていたタブを個別に保存・復元
- **初回起動サポート**: 初回起動時に~/Documents/memo3フォルダと説明ファイルを自動作成
- **フォルダベース管理**: 好きなフォルダを選択してワークスペースとして利用
- **自動ファイル監視**: chokidarによるリアルタイムファイル変更監視
- **外部変更の自動反映**: 他のエディタで変更したファイルを自動再読み込み
- **カーソル位置保持**: 再読み込み時もカーソルとスクロール位置を保持
- **一時ファイルフィルタ**: バックアップ（~）、スワップ（.swp）、隠しファイル（.）を自動除外
- **対応ファイル**: .md（マークダウン）、.txt（テキスト）ファイル
- **自動ソート**: 更新日時順でファイルを自動整理

### 📄 マルチタブエディタ
- **タブ管理**: 複数ファイルの同時編集
- **新規タブ作成**: ⌘N（macOSのみ）、+ボタン、または空状態ボタンで作成
- **空状態UI**: タブが無い時にエディタ中央に「新しい文書を作成」ボタンを表示
- **統一デザイン**: 新規タブボタンとワークスペース追加ボタンが同じ青色
- **タブスクロール**: 多数のタブを開いた時は左右矢印ボタン（‹ ›）でスクロール
- **スマートレイアウト**: 画面幅を考慮した最適配置、オーバーフロー防止
- **ドラッグ&ドロップ**: タブの並び替えが可能
- **スマートファイル作成**: 2行以上の内容で自動的にファイル作成
- **自動ファイル名生成**: 最初の行をもとにファイル名を自動生成
- **未保存タブ保護**: ワークスペース切り替え時、未保存の新規タブがあれば確認ダイアログを表示
- **セッション復元**: アプリ再起動時に開いていたタブを自動復元、存在するファイルのみ復元
- **ファイル名変更追跡**: ファイル名変更時に即座にセッションを更新、次回起動時も正しく復元

### 🔍 強化された検索機能
- **ファイル名検索**: ファイル名による高速検索
- **内容検索**: ファイル内のテキスト全文検索
- **マッチ表示**: 一致したテキストスニペットと行番号を表示
- **検索結果表示**: ファイル情報（タイトル、ファイル名、更新日時）とマッチした内容
- **ワンクリックアクセス**: 検索結果から直接ファイルを開く
- **行ジャンプ**: マッチした行をクリックすると、該当行にスクロール
- **タグフィルタ連携**: テキスト検索とタグフィルタを組み合わせて絞り込み

### 🏷️ タグ管理機能
- **カラータグ**: 16色のパレットから選択してタグを作成
- **設定画面でタグ管理**: 専用の「タグ」タブでタグの作成、編集、削除、並べ替えが可能
- **ドラッグ&ドロップ並べ替え**: 設定画面でタグをドラッグして順序変更、全表示に反映
- **クイック作成**: 検索ボックスにタグ名を入力してEnterで即座に作成
- **ファイルヘッダー表示**: ファイル名の後ろにタグバッジを表示、sellアイコンで編集
- **ファイルへのタグ付け**: 右クリックメニューまたはファイルヘッダーのsellアイコンから簡単にタグを割り当て
- **3状態フィルタ**: 表示・非表示・無効の3つの状態でファイルをフィルタリング
- **フィルタークリア**: タグフィルターヘッダーの「クリア」ボタンで一括リセット
- **視覚的表示**: ファイルリストのアイコンが先頭タグの色で表示、タグの順序を一目で把握
- **一貫した順序**: ファイルヘッダー、タグフィルター、ファイルアイコンの色が同じ順序で表示
- **タグ編集**: 名前と色を統合ダイアログで編集、右クリックで素早くアクセス
- **セッション保存**: タグフィルタ状態をワークスペースごとに保存
- **複数PC同期対応**: イベントソーシング方式で衝突のない同期をサポート
- **Material Symbols**: UI全体で一貫性のあるアイコンデザイン（folder、search、preview、routine、space_bar、text_decrease、text_increase、settings、sell、draft、docsなど）

### ⚡ 自動保存機能
- **スマート自動保存**: 編集後5秒で自動保存
- **IME対応自動保存**: 日本語入力（IME変換）中は自動保存を延期し、文字消失を防止
- **自動リトライ**: IME変換中の場合は保存を再スケジュールして安全に実行
- **変更検知**: 内容が変更された場合のみ保存を実行
- **タブクローズ時保存**: タブを閉じる際の自動保存

### 🎨 テーマシステム
- **7種類のテーマ**: Monokai、GitHub、Tomorrow、Twilight、Solarized、Dracula など
- **2テーマ切り替え**: 設定で選択した2つのテーマをボタンで素早く切り替え
- **設定保護**: テーマ切り替え時も設定画面の値は変更されず、プリセットが保持される
- **アプリ全体連動**: エディタテーマに合わせてUI全体の色が変更
- **CSS変数活用**: 動的なテーマ切り替え

### ⚙️ 豊富なエディタ設定
- **タブ化された設定画面**: 全般、エディタ、タグの3つのタブで整理
- **全般タブ**: 作業フォルダの選択
- **エディタタブ**: キーバインド（Vim、Emacs、VSCodeなど）、テーマ1・2、フォントサイズ、折り返し、行番号表示
- **タグタブ**: タグの作成、編集、削除、ドラッグ&ドロップでの並べ替え
- **空白文字表示**: スペース・タブの可視化
- **マークダウンプレビュー**: 別ウィンドウでリアルタイムプレビュー
- **プレビューコントロール**: ダーク/ライトモード切り替え、印刷、ズーム機能（縮小/等倍/拡大）、再読み込み
- **プレビュー表示**: 見出し階層、太字・斜体・取消線、ネストされた箇条書き、コードブロック、引用、表、区切り線（---/****）の完全サポート
- **印刷機能**: プレビュー内容を適切にフォーマットして印刷、長い行も折り返して表示
- **ACEエディタ統合**: 高機能なコードエディタライブラリを採用

### 🖱️ 直感的なUI
- **コンテキストメニュー**:
  - ファイル: ファイル名更新・削除
  - ステータスバー: 開発者ツールアクセス
  - エディタ: URL開く・Google検索・標準編集機能・箇条書き操作
- **箇条書き機能**: 選択行の一括操作
  - 箇条書き(-)にする: 各行頭に "- " を追加（先頭空白保持）
  - 箇条書き(1)にする: 各行頭に "1. " を追加（先頭空白保持）
  - 箇条書きをやめる: "- ", "* ", "1. " を削除
  - Tabキーでインデント: 箇条書き行でTabキーを押すとインデント追加（2スペース）
  - Shift+Tabでアウトデント: 箇条書き行でShift+Tabを押すとインデント削除（2スペース）
  - Undo/Redo完全対応
- **ファイル情報表示**: フォルダパス・ファイルパスを2行で表示
- **スマートポジショニング**: 画面端でのメニュー自動調整
- **テーマ切り替えボタン**: 🎨アイコンで設定した2つのテーマを即座に切り替え
- **フラットデザインボタン**: 設定ボタンとテーマボタンがフラットデザインで統一

### 🔗 外部連携機能
- **URL自動検出**: テキスト内のURLを検出し、右クリックでブラウザで開く
- **Google検索**: 選択したテキストを右クリックでGoogle検索
- **即座にアクセス**: 外部リンクや検索をワンクリックで実行

### ⌨️ 高度なキーボード操作
- **新規タブ作成**: `Cmd+N` (macOSのみ) で新しいタブを開く
- **エディタ内検索**: `Ctrl+F` (Windows) / `Cmd+F` (Mac) で検索開始
- **Emacsスタイル検索**: Emacsキーバインド時の高度な検索ナビゲーション
  - `^S` (Ctrl+S): 検索開始 / 次の候補
  - `^R` (Ctrl+R): 前の候補
  - `^G` (Ctrl+G): 検索終了
- **スマートフォーカス**: 検索フィールドからエディタへの自動フォーカス移動

## 技術仕様

- **フレームワーク**: Electron 37.4.0
- **エディタ**: ACE Editor 1.43.2
- **ファイル監視**: chokidar 4.0.3
- **アイコン**: Material Symbols (material-symbols)
- **対応プラットフォーム**: macOS（Intel・Apple Silicon対応のUniversal Binary）

### macOS 固有の問題対応

- **IMK エラー対応**: macOS の Input Method Kit (IMK) に関連するエラーメッセージ `error messaging the mach port for IMKCFRunLoopWakeUpReliable` が発生してもアプリが停止しないよう対策済み
- **エラー抑制**: 日本語入力時に発生する可能性のあるシステムレベルのエラーを適切にハンドリング

## インストール・起動方法

### 開発環境での起動
```bash
# 依存関係のインストール
npm install

# 開発モードで起動
npm run dev

# 本番モードで起動
npm start
```

### アプリケーションのビルド
```bash
# macOS Universal Binary（Intel + Apple Silicon）
npm run build

# 全プラットフォーム（macOS arm64, macOS x64, Windows x64）
npm run build-all
```

ビルド結果は`dist/`ディレクトリに出力されます：
- macOS: `memo3-{version}-arm64.dmg`, `memo3-{version}-x64.dmg`（build-allの場合）
- macOS: `memo3-{version}-universal.dmg`（buildの場合）
- Windows: `memo3 Setup {version}.exe`（build-allの場合のみ）

## アーキテクチャ

### メインプロセス（main.js）
- アプリケーションライフサイクル管理
- ウィンドウ作成・管理
- IPCによるレンダラープロセスとの通信
- ファイルシステム操作・監視

### レンダラープロセス
- **index.html**: メインUIの構造
- **renderer.js**: タブ管理、検索機能、ファイル操作の実装
- **styles.css**: 動的テーマシステム、レスポンシブデザイン
- **preview.html**: プレビューウィンドウのUI
- **preview-renderer.js**: マークダウンからHTMLへの変換、プレビュー機能

### セキュリティ
- **preload.js**: contextBridgeによる安全なIPC通信
- **Context Isolation**: 有効化済み
- **Node Integration**: 無効化済み

## データ保存

アプリケーションは以下のファイルでデータを管理します：

- **ユーザー選択フォルダ**: .md/.txt ファイルの保存場所
- **workspace.json**: 複数ワークスペース設定（version 2.0形式、ワークスペースリスト、アクティブワークスペース）
- **settings.json**: エディタ設定（キーバインド、テーマ、フォントサイズ等）
- **sessions.json**: ワークスペースごとのセッション状態（開いているタブ、アクティブタブ等）
- **tags.json**: タグ定義とファイル関連付け（イベントソーシング形式、複数PC間の同期対応）

### マイグレーション
旧形式（workspace.json、session.json）から新形式へ自動的に移行されます。

## 開発・カスタマイズ

### IPC通信チャンネル

#### ファイル管理
- `get-files`: ファイル一覧取得
- `load-file`: ファイル内容読み込み
- `save-file`: ファイル保存
- `create-file`: 新規ファイル作成
- `delete-file`: ファイル削除
- `rename-file`: ファイル名変更
- `search-files-content`: ファイル検索

#### 設定・セッション
- `get-settings` / `save-settings`: エディタ設定
- `get-session` / `save-session`: ワークスペースごとのセッション状態
- `select-folder`: フォルダ選択（即座反映、再起動不要、ワークスペースリストに追加）

#### ワークスペース管理
- `get-workspaces`: 全ワークスペースとアクティブワークスペースを取得
- `add-workspace`: 新規ワークスペース追加（フォルダ選択ダイアログ）
- `switch-workspace`: ワークスペース切り替え（セッション保存・復元）
- `remove-workspace`: ワークスペースをリストから削除（フォルダは削除しない）

#### タグ管理
- `get-tags`: 全タグとファイル関連付けを取得
- `create-tag`: 新規タグ作成（名前、色、順序）
- `update-tag`: タグのプロパティ更新（名前または色）
- `delete-tag`: タグとその関連付けをすべて削除
- `add-file-tag`: ファイルにタグを関連付け
- `remove-file-tag`: ファイルからタグの関連付けを削除
- `get-file-tags`: 特定ファイルの全タグを取得

#### プレビュー
- `open-preview`: マークダウンプレビューを別ウィンドウで開く
- `update-preview`: プレビュー内容を更新
- `request-preview-reload`: 現在のアクティブタブからプレビューを再読み込み

#### 外部アクション
- `open-url`: URLをデフォルトブラウザで開く
- `search-google`: 選択テキストをGoogle検索

### カスタムテーマの追加

`styles.css`のCSS変数を変更することで、新しいテーマを追加できます：

```css
:root {
  --bg-color: #your-bg-color;
  --sidebar-color: #your-sidebar-color;
  --text-color: #your-text-color;
  /* ... その他の変数 */
}
```

## ライセンス

not decided yet.

## 作者

ytx @ memo3
