# memo3 操作マニュアル

memo3は、Electron とACE エディターを使用したマークダウン対応のメモアプリケーションです。VSCode のような多タブ編集機能と、ファイルシステムベースの管理機能を提供します。

## 目次
1. [起動と初期設定](#起動と初期設定)
2. [基本操作](#基本操作)
3. [ワークスペース管理](#ワークスペース管理)
4. [ファイル管理](#ファイル管理)
5. [タブ管理](#タブ管理)
6. [検索機能](#検索機能)
7. [タグ管理](#タグ管理)
8. [設定とカスタマイズ](#設定とカスタマイズ)
9. [コンテキストメニュー](#コンテキストメニュー)
10. [キーボードショートカット](#キーボードショートカット)
11. [セッション復元](#セッション復元)

---

## 起動と初期設定

### 起動方法
- **開発モード**: `npm run dev`
- **本番モード**: `npm start`

### 初期設定
1. アプリ起動後、設定画面でルートフォルダーを選択
2. 選択したフォルダー内の `.md` および `.txt` ファイルが自動的に読み込まれます
3. ファイルリストは更新日時の降順で表示されます

---

## 基本操作

### ファイルの表示
- ファイルリストには以下が表示されます：
  - **アイコン**: タグなし文書は📄（draft）、タグあり文書は📋（docs）
  - **タイトル**: ファイルの最初の非空行
  - **ファイル名**: 実際のファイル名（タグがある場合は🏷️アイコン付き、ホバーでタグ詳細表示）
  - **更新日時**: YYYY/MM/DD HH:MM 形式

### 新規ファイル作成
1. **+** ボタンをクリック
2. エディターに「タイトルを入力してください」プレースホルダーが表示
3. 2行以上の非空行を入力すると自動的にファイルが作成されます
4. ファイル名は最初の行（最大16文字）+ `.md` 拡張子で自動生成
5. 重複する場合は自動的に (2), (3) などが付加されます

### 自動保存機能
- 編集後5秒で自動保存
- IME（日本語入力）変換中は自動保存を延期し、文字消失を防止
- 変更がない場合は保存をスキップ
- タブを閉じる際に未保存の変更があれば自動保存

---

## ワークスペース管理

### ワークスペースとは
- 複数のプロジェクトフォルダーを管理できる機能
- 各ワークスペースは独立したセッション状態を保持
- ワークスペース間の切り替えが簡単

### ワークスペースの追加
1. サイドバー上部の **+** ボタンをクリック
2. フォルダー選択ダイアログで対象フォルダーを選択
3. 自動的に新しいワークスペースに切り替わります
4. 選択したフォルダー内の `.md` および `.txt` ファイルが表示されます

### ワークスペースの切り替え
1. サイドバー上部のワークスペース名をクリック
2. ドロップダウンメニューから切り替え先を選択
3. 現在開いているタブが自動保存されます
4. 切り替え先のワークスペースの前回のセッションが復元されます

### ワークスペースの削除
1. ワークスペース名をクリックしてメニューを開く
2. 削除したいワークスペースにマウスオーバー
3. **解除** ボタンをクリック
4. 確認ダイアログで実行
- **注意**: フォルダー自体は削除されず、ワークスペースリストから除外されるだけです

### 未保存タブの保護
- ワークスペース切り替え時に未保存の新規タブがある場合、確認ダイアログが表示されます
- 「OK」を選択すると自動的にファイルとして保存されます
- 「キャンセル」を選択すると切り替えがキャンセルされます

### 初回起動時の動作
- 初回起動時は `~/Documents/memo3` フォルダーが自動作成されます
- 3つのウェルカムファイル（概要.md、操作説明.md、サンプル.md）が生成されます

---

## ファイル管理

### ファイルの開き方
- ファイルリストから該当ファイルをクリック
- 新しいタブで開きます（既存のタブがある場合は自動で閉じられることがあります）

### ファイルの削除
1. ファイルを右クリック
2. **削除** を選択
3. 確認ダイアログで削除を実行

### ファイル名の更新
1. ファイルを右クリック
2. **ファイル名更新** を選択
3. ファイル内容の最初の行に基づいて自動更新

### リアルタイム更新
- ファイルシステムの変更を自動検出
- ファイルリストの順序が自動更新
- 外部エディターでの変更も反映

---

## タブ管理

### タブの操作
- **新規タブ**: + ボタンをクリック、または Cmd+N（macOS）
- **タブの並び替え**: ドラッグ&ドロップで順序変更
- **タブを閉じる**: タブの × ボタンをクリック
- **アクティブタブ**: 選択中のタブは視覚的に区別表示
- **タブスクロール**: 多数のタブがある場合は左右の矢印ボタン（‹ ›）でスクロール

### タブタイトル
- ファイル内容の最初の非空行がタブタイトルになります
- 内容を変更するとタイトルも自動更新

### 空の状態
- タブが1つもない場合、エディタ中央に「新しい文書を作成」ボタンが表示されます
- このボタンをクリックすると新規タブが作成されます

---

## 検索機能

### 検索の実行
1. 検索ボックスに検索語を入力
2. ファイル名と内容の両方を同時検索
3. 結果は以下に分類表示：
   - **ファイル名マッチ**: 緑色表示、「ファイル名」ラベル付き
   - **内容マッチ**: 白色表示、「行 N」ラベルと一致したテキストスニペット表示

### 検索結果の操作
- ファイル名部分をクリックして該当ファイルを開く
- 内容マッチ（「行 N」部分）をクリックすると、ファイルを開いて該当行に自動スクロール
- **×** ボタンで検索結果をクリア

### 検索結果の表示内容
- 各ファイルごとにマッチした全ての行を表示
- マッチしたテキストスニペットで内容を確認できます
- 行番号付きで該当箇所を正確に把握

### エディター内検索（Emacsキーバインド使用時）
- **Ctrl+S**: 検索開始/次の候補
- **Ctrl+R**: 前の候補
- **Ctrl+G**: 検索終了

---

## タグ管理

### タグとは
- ファイルを分類・整理するためのラベル機能
- 各タグには名前と色を設定可能
- 複数のファイルに同じタグを付けることができます
- 16色のカラーパレットから色を選択

### タグフィルターの開き方
1. 検索ボックス右側の**タグアイコン（🏷️）**をクリック
2. サイドバーにタグリストが表示されます

### タグの作成
**方法1: タグダイアログから作成**
1. ファイルを右クリック → **タグを編集** を選択
2. タグダイアログが開きます
3. 検索ボックスに新しいタグ名を入力
4. **Enter** キーを押すと自動的にタグが作成されます
5. ランダムな色が自動割り当てされます

**方法2: タグフィルターから作成**
1. タグフィルターボタンをクリック
2. タグリストが表示されます（まだタグがない場合は空）
3. 別の方法で作成する必要があります（方法1を使用）

### ファイルへのタグ付け
1. ファイルを右クリック → **タグを編集**
2. タグダイアログが表示されます
3. タグをクリックすると以下のように動作：
   - **透明なタグ**: クリックすると色付きに変わり、ファイルに関連付けられます
   - **色付きタグ**: クリックすると透明に戻り、関連付けが解除されます
4. **閉じる** ボタンで完了

### タグの編集
1. タグダイアログを開く（ファイルを右クリック → **タグを編集**）
2. 編集したいタグを右クリック
3. **編集** を選択
4. 編集ダイアログで以下を変更：
   - **タグ名**: 新しい名前を入力
   - **色**: 16色のパレットから選択（クリックで選択、プレビューで確認）
5. **保存** ボタンで変更を適用

### タグの削除
1. タグダイアログを開く
2. 削除したいタグを右クリック
3. **削除** を選択
4. タグとすべてのファイル関連付けが削除されます

### タグによるフィルタリング
1. タグフィルターボタンをクリック
2. タグリストが表示されます
3. タグをクリックすると3つの状態を切り替え：
   - **無効（透明背景）**: フィルタリングなし
   - **表示（青背景）**: そのタグが付いたファイルのみ表示
   - **非表示（赤背景）**: そのタグが付いたファイルを除外
4. 複数のタグを組み合わせて使用可能
5. **×** ボタンでフィルタをクリア

### 検索とタグフィルタの組み合わせ
- テキスト検索とタグフィルタを同時に使用可能
- 例: 「TODO」で検索 + 「重要」タグを表示 → 重要なTODOのみ表示
- フィルタを変更すると検索結果も自動更新されます

### ファイルリストのタグ表示
- タグが付いているファイルには**タグアイコン（🏷️）**が表示されます
- アイコンにマウスをホバーすると、タグの詳細がツールチップで表示されます
- ツールチップには色付きのタグバッジが表示されます

### タグの色パレット
16色から選択可能：
- 赤、ピンク、紫、深紫
- 藍、青、水色、シアン
- ティール、緑、ライムグリーン、ライム
- 黄、アンバー、オレンジ、茶

### 複数PC間での同期
- タグデータは `tags.json` に保存されます
- イベントソーシング方式を採用
- 複数のPCで同じフォルダを編集しても競合なく同期されます
- 各操作がログとして記録され、時系列で統合されます

---

## 設定とカスタマイズ

### 設定項目
- **キーバインド**: 標準またはEmacs
- **テーマ**: 7種類以上のACEエディターテーマ
- **フォントサイズ**: 調整可能
- **ホワイトスペース表示**: オン/オフ切り替え
- **ルートフォルダー**: メモ保存先の変更

### テーマシステム
- ACEエディターのテーマ選択
- アプリ全体の色がエディターテーマに自動連動
- 対応テーマ: Monokai, GitHub, Tomorrow, Twilight, Solarized, Dracula など

### マークダウンプレビュー
エディタヘッダーのプレビューボタン（👁️アイコン）をクリックすると、別ウィンドウでプレビューが表示されます。

**対応する記法:**
- **見出し**: `#` から `######` まで（h1-h6）
- **太字**: `**太字**` または `__太字__`
- **斜体**: `*斜体*` または `_斜体_`
- **取消線**: `~~取消線~~`
- **箇条書き**: `-` または `*` で開始（ネスト対応）
- **番号付きリスト**: `1.` で開始（ネスト対応）
- **コードブロック**: \`\`\` で囲む（余計な改行なし）
- **インラインコード**: \` で囲む
- **引用**: `>` で開始（複数行の統合処理）
- **表**: パイプ区切り（`| ヘッダー1 | ヘッダー2 |`）
- **水平線**: `---` または `****`
- **リンク**: `[テキスト](URL)`
- **画像**: `![代替テキスト](URL)`

**プレビューコントロール:**
- **テーマ切り替え**: ライトモード/ダークモードの切り替え
- **印刷**: プレビュー内容を印刷
- **ズーム**: 縮小/等倍/拡大の切り替え
- **再読み込み**: 現在のアクティブタブから内容を再取得

### UIアイコン
アプリ全体でMaterial Symbolsアイコンを使用しています：
- **folder**: ワークスペース選択
- **search**: 検索ボックス
- **preview**: マークダウンプレビュー
- **routine**: テーマ切り替え
- **space_bar**: 空白文字表示切り替え
- **text_decrease**: フォントサイズ縮小
- **text_increase**: フォントサイズ拡大
- **settings**: 設定
- **sell**: タグフィルター/タグアイコン
- **draft**: タグなし文書
- **docs**: タグあり文書

すべてのアイコンは現在のテーマに応じて自動的に色が調整されます。

### 設定の保存
- 設定変更は即座に保存
- 設定ファイル: `settings.json`
- アプリ再起動は不要

---

## コンテキストメニュー

### ファイルリストでの右クリック
- **タグを編集**: ファイルにタグを付けたり外したりする
- **ファイル名更新**: 内容に基づく自動リネーム
- **削除**: 確認付きファイル削除

### ステータスバーでの右クリック
- **開発者ツール**: 別ウィンドウで開発者ツールを表示

### エディターでの右クリック
- **URLを開く**: URL上で右クリックしてブラウザーで開く
- **Googleで検索**: 選択テキストをGoogleで検索
- **標準編集機能**: コピー、カット、ペーストなど
- **箇条書き操作**:
  - **箇条書き(-)にする**: 選択行の先頭に「- 」を追加（先頭空白保持）
  - **箇条書き(1)にする**: 選択行の先頭に「1. 」を追加（先頭空白保持）
  - **箇条書きをやめる**: 「- 」「* 」「1. 」を削除
  - 全操作でUndo/Redo完全対応

### スマートポジショニング
- コンテキストメニューは画面端で自動位置調整
- 常に画面内に表示されます

---

## キーボードショートカット

### 標準ショートカット
- **Ctrl+C / Cmd+C**: コピー
- **Ctrl+X / Cmd+X**: カット
- **Ctrl+V / Cmd+V**: ペースト
- **Ctrl+Z / Cmd+Z**: 元に戻す
- **Ctrl+Y / Cmd+Y**: やり直し

### Emacsキーバインド（設定で有効化時）
- **Ctrl+W**: カット
- **Alt+W**: コピー
- **Ctrl+Y**: ペースト
- **Ctrl+S**: 検索開始/次の候補
- **Ctrl+R**: 前の検索候補
- **Ctrl+G**: 検索終了

### 箇条書きのショートカット
- **Tab**: 箇条書き行でインデントを増やす（2スペース追加）
- **Shift+Tab**: 箇条書き行でインデントを減らす（2スペース削除）
- 対応する箇条書き形式: 「- 」「* 」「1. 」など

### その他のショートカット
- **Cmd+N (macOS)**: 新しいタブを作成

### システムクリップボード連携
- 他のアプリケーションとの完全なクリップボード同期
- Windows、macOS、Linux 対応
- 複数層のクリップボード処理で確実な動作

---

## セッション復元

### 自動復元機能
- アプリ起動時に前回のセッション状態を自動復元
- 各ワークスペースごとに独立したセッションを保持
- 開いていたタブとアクティブタブを復元
- ファイル内容と編集状態も復元

### セッション管理
- タブ操作の度に自動的にセッション状態を保存
- ワークスペース切り替え時に現在のセッションを保存
- ファイルが削除された場合は対応するタブも除外
- セッションファイル: `sessions.json`（ワークスペースごと）

### 復元される情報
- 開いていたファイルのタブ（ワークスペースごと）
- アクティブなタブ（ワークスペースごと）
- エディターの状態
- ファイルの内容
- ワークスペースの選択状態

---

## データ管理

### 保存場所
- **メモファイル**: 各ワークスペースのルートフォルダー内
- **ワークスペース設定**: `workspace.json`（version 2.0形式、ワークスペースリストとアクティブワークスペース）
- **エディター設定**: `settings.json`
- **セッション状態**: `sessions.json`（ワークスペースごとのセッション）
- **タグデータ**: `tags.json`（各ワークスペースのルートフォルダー内、イベントソーシング形式）

### ファイル監視
- chokidar を使用したリアルタイムファイル監視
- 外部での変更を自動検出
- ファイルリストの自動更新
- 一時ファイル（~、.swp、.、.DS_Store、.tmp）は自動除外

---

## トラブルシューティング

### よくある問題

**ファイルが表示されない**
- ルートフォルダーの設定を確認
- `.md` または `.txt` 拡張子のファイルのみ表示

**タブが復元されない**
- 対象ファイルが存在するか確認
- セッションファイルの破損の可能性

**検索が動作しない**
- ファイルへの読み取り権限を確認
- 検索対象フォルダーのアクセス権限を確認

**テーマが適用されない**
- 設定の再読み込み
- アプリの再起動

### 開発者ツール
- ステータスバーを右クリック → **開発者ツール**
- コンソールでエラーログを確認可能

---

## システム要件
- **Electron**: 37.4.0
- **ACE Editor**: 1.43.2
- **File Watcher**: chokidar 4.0.3
- **Icons**: Material Symbols (material-symbols)
- **対応OS**: Windows, macOS, Linux

---

## 更新履歴

### 最新版
- **タグ管理機能**: 16色のカラータグでファイルを分類、3状態フィルタリング、イベントソーシング方式で複数PC間の同期に対応
- **Material Symbols**: タグアイコンなどに Material Symbols を採用、一貫性のあるアイコンデザイン
- **検索とタグの統合**: テキスト検索とタグフィルタを組み合わせて使用可能
- **タグ視覚化**: ファイルリストにタグアイコン表示、ホバーで詳細を確認

### 以前のバージョン
- **検索機能の強化**: マッチしたテキストスニペットと行番号を表示、クリックで該当行へジャンプ
- **箇条書きインデント**: TabキーとShift+Tabで箇条書き行のインデント調整が可能
- **ワークスペース管理**: 複数のプロジェクトフォルダーを管理、ワークスペースごとに独立したセッション
- **ビルド機能拡張**: `npm run build-all`で macOS（arm64/x64）と Windows（x64）を一度にビルド可能

### 以前のバージョン
- 完全なセッション復元とクリップボード統合を実装
- ドラッグ&ドロップによるタブ並び替え機能を追加
- スマートなファイル作成とリアルタイムファイル監視を実装
- IME対応自動保存機能を追加（日本語入力時の文字消失を防止）