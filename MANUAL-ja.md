# memo3 操作マニュアル

memo3は、Electron とACE エディターを使用したマークダウン対応のメモアプリケーションです。VSCode のような多タブ編集機能と、ファイルシステムベースの管理機能を提供します。

## 目次
1. [起動と初期設定](#起動と初期設定)
2. [基本操作](#基本操作)
3. [ワークスペース管理](#ワークスペース管理)
4. [ファイル管理](#ファイル管理)
5. [タブ管理](#タブ管理)
6. [検索機能](#検索機能)
7. [タグ管理](#タグ管理)
8. [表編集機能](#表編集機能)
9. [設定とカスタマイズ](#設定とカスタマイズ)
10. [コンテキストメニュー](#コンテキストメニュー)
11. [キーボードショートカット](#キーボードショートカット)
12. [セッション復元](#セッション復元)

---

## 起動と初期設定

### 起動方法
- **開発モード**: `npm run dev`
- **本番モード**: `npm start`

### 初期設定
1. アプリ起動後、設定画面でルートフォルダーを選択
2. 選択したフォルダー内の `.md` および `.txt` ファイルが自動的に読み込まれます
3. ファイルリストは更新日時の降順で表示されます

---

## 基本操作

### ファイルの表示
- ファイルリストには以下が表示されます：
  - **アイコン**: タグなし文書は📄（draft）、タグあり文書は📋（docs、先頭タグの色で表示）
  - **タイトル**: ファイルの最初の非空行
  - **ファイル名**: 実際のファイル名
  - **更新日時**: YYYY/MM/DD HH:MM 形式
- ファイルを開くと、エディタヘッダーのファイル名の後ろにタグバッジが表示されます
- タグバッジの右側の🏷️（sell）アイコンをクリックすると、タグの編集ができます

### 新規ファイル作成
1. **+** ボタンをクリック
2. エディターに「タイトルを入力してください」プレースホルダーが表示
3. 2行以上の非空行を入力すると自動的にファイルが作成されます
4. ファイル名は最初の行（最大16文字）+ `.md` 拡張子で自動生成
5. 重複する場合は自動的に (2), (3) などが付加されます

### 自動保存機能
- 編集後5秒で自動保存
- IME（日本語入力）変換中は自動保存を延期し、文字消失を防止
- 変更がない場合は保存をスキップ
- タブを閉じる際に未保存の変更があれば自動保存

---

## ワークスペース管理

### ワークスペースとは
- 複数のプロジェクトフォルダーを管理できる機能
- 各ワークスペースは独立したセッション状態を保持
- ワークスペース間の切り替えが簡単

### ワークスペースの追加
1. サイドバー上部の **+** ボタンをクリック
2. フォルダー選択ダイアログで対象フォルダーを選択
3. 自動的に新しいワークスペースに切り替わります
4. 選択したフォルダー内の `.md` および `.txt` ファイルが表示されます

### ワークスペースの切り替え
1. サイドバー上部のワークスペース名をクリック
2. ドロップダウンメニューから切り替え先を選択
3. 現在開いているタブが自動保存されます
4. 切り替え先のワークスペースの前回のセッションが復元されます

### ワークスペースの削除
1. ワークスペース名をクリックしてメニューを開く
2. 削除したいワークスペースにマウスオーバー
3. **解除** ボタンをクリック
4. 確認ダイアログで実行
- **注意**: フォルダー自体は削除されず、ワークスペースリストから除外されるだけです

### 未保存タブの保護
- ワークスペース切り替え時に未保存の新規タブがある場合、確認ダイアログが表示されます
- 「OK」を選択すると自動的にファイルとして保存されます
- 「キャンセル」を選択すると切り替えがキャンセルされます

### 初回起動時の動作
- 初回起動時は `~/Documents/memo3` フォルダーが自動作成されます
- 3つのウェルカムファイル（概要.md、操作説明.md、サンプル.md）が生成されます

---

## ファイル管理

### ファイルの開き方
- ファイルリストから該当ファイルをクリック
- 新しいタブで開きます（既存のタブがある場合は自動で閉じられることがあります）

### ファイルの削除
1. ファイルを右クリック
2. **削除** を選択
3. 確認ダイアログで削除を実行

### ファイル名の更新
1. ファイルを右クリック
2. **ファイル名更新** を選択
3. ファイル内容の最初の行に基づいて自動更新

### リアルタイム更新
- ファイルシステムの変更を自動検出
- ファイルリストの順序が自動更新
- 外部エディターでの変更も反映

---

## タブ管理

### タブの操作
- **新規タブ**: + ボタンをクリック、または Cmd+N（macOS）
- **タブの並び替え**: ドラッグ&ドロップで順序変更
- **タブを閉じる**: タブの × ボタンをクリック
- **アクティブタブ**: 選択中のタブは視覚的に区別表示
- **タブスクロール**: 多数のタブがある場合は左右の矢印ボタン（‹ ›）でスクロール

### タブタイトル
- ファイル内容の最初の非空行がタブタイトルになります
- 内容を変更するとタイトルも自動更新

### 空の状態
- タブが1つもない場合、エディタ中央に「新しい文書を作成」ボタンが表示されます
- このボタンをクリックすると新規タブが作成されます

---

## 検索機能

### 検索の実行
1. 検索ボックスに検索語を入力
2. ファイル名と内容の両方を同時検索
3. 結果は以下に分類表示：
   - **ファイル名マッチ**: 緑色表示、「ファイル名」ラベル付き
   - **内容マッチ**: 白色表示、「行 N」ラベルと一致したテキストスニペット表示

### 検索結果の操作
- ファイル名部分をクリックして該当ファイルを開く
- 内容マッチ（「行 N」部分）をクリックすると、ファイルを開いて該当行に自動スクロール
- **×** ボタンで検索結果をクリア

### 検索結果の表示内容
- 各ファイルごとにマッチした全ての行を表示
- マッチしたテキストスニペットで内容を確認できます
- 行番号付きで該当箇所を正確に把握

### エディター内検索（Emacsキーバインド使用時）
- **Ctrl+S**: 検索開始/次の候補
- **Ctrl+R**: 前の候補
- **Ctrl+G**: 検索終了

---

## タグ管理

### タグとは
- ファイルを分類・整理するためのラベル機能
- 各タグには名前と色を設定可能
- 複数のファイルに同じタグを付けることができます
- 16色のカラーパレットから色を選択
- タグの順序を設定でき、全表示に反映されます

### タグフィルターの開き方
1. 検索ボックス右側の**タグアイコン（🏷️）**をクリック
2. サイドバーにタグリストが表示されます

### タグの作成

**方法1: 設定画面から作成（推奨）**
1. 設定ボタン（⚙️）をクリック
2. **タグ** タブを選択
3. 「タグ検索」ボックスに新しいタグ名を入力
4. **Enter** キーを押すと自動的にタグが作成されます
5. ランダムな色が自動割り当てされます

**方法2: タグダイアログから作成**
1. ファイルを右クリック → **タグを編集** を選択（またはファイルヘッダーの🏷️アイコンをクリック）
2. タグダイアログが開きます
3. 検索ボックスに新しいタグ名を入力
4. **Enter** キーを押すと自動的にタグが作成されます
5. ランダムな色が自動割り当てされます

### タグの並べ替え
1. 設定ボタン（⚙️）をクリック → **タグ** タブを選択
2. タグ一覧が表示されます
3. タグをドラッグ&ドロップで並べ替え
4. 順序は自動的に保存されます
5. **設定を閉じると**、以下すべてに順序が反映されます：
   - ファイルヘッダーのタグバッジ表示
   - タグフィルターのリスト
   - ファイルリストのアイコン色（先頭タグの色）

### ファイルへのタグ付け

**方法1: ファイルヘッダーから**
1. ファイルを開く
2. エディタヘッダーのファイル名右側の**🏷️アイコン**をクリック
3. タグダイアログが表示されます
4. タグをクリックすると以下のように動作：
   - **透明なタグ**: クリックすると色付きに変わり、ファイルに関連付けられます
   - **色付きタグ**: クリックすると透明に戻り、関連付けが解除されます
5. **閉じる** ボタンで完了

**方法2: 右クリックメニューから**
1. ファイルリストでファイルを右クリック → **タグを編集**
2. 以降は方法1と同じ

### タグの編集

**設定画面から編集（推奨）**
1. 設定ボタン（⚙️）をクリック → **タグ** タブを選択
2. 編集したいタグの**編集**ボタンをクリック
3. 編集ダイアログで以下を変更：
   - **タグ名**: 新しい名前を入力
   - **色**: 16色のパレットから選択（クリックで選択、プレビューで確認）
4. **保存** ボタンで変更を適用

**タグダイアログから編集**
1. タグダイアログを開く
2. 編集したいタグを右クリック
3. **編集** を選択
4. 同様に編集可能

### タグの削除

**設定画面から削除（推奨）**
1. 設定ボタン（⚙️）をクリック → **タグ** タブを選択
2. 削除したいタグの**削除**ボタンをクリック
3. タグとすべてのファイル関連付けが削除されます

**タグダイアログから削除**
1. タグダイアログを開く
2. 削除したいタグを右クリック
3. **削除** を選択

### タグによるフィルタリング
1. タグフィルターボタンをクリック
2. タグリストが表示されます（設定で定義した順序）
3. タグをクリックすると3つの状態を切り替え：
   - **無効（透明背景）**: フィルタリングなし
   - **表示（青背景）**: そのタグが付いたファイルのみ表示
   - **非表示（赤背景）**: そのタグが付いたファイルを除外
4. 複数のタグを組み合わせて使用可能
5. **クリア** ボタンで全フィルタを一括リセット

### 検索とタグフィルタの組み合わせ
- テキスト検索とタグフィルタを同時に使用可能
- 例: 「TODO」で検索 + 「重要」タグを表示 → 重要なTODOのみ表示
- フィルタを変更すると検索結果も自動更新されます

### タグの視覚的表示

**ファイルヘッダー**
- 開いているファイルのファイル名の後ろにタグバッジが表示されます
- バッジは設定で定義した順序で表示されます
- 🏷️アイコンをクリックするとタグの編集ができます

**ファイルリストのアイコン**
- タグなしファイル: 📄（draft）アイコン、通常の色
- タグありファイル: 📋（docs）アイコン、**先頭タグの色**で表示
- 先頭タグは設定画面で定義した順序の最初のタグです
- 順序を変更すると、アイコンの色も自動的に更新されます

### タグの色パレット
16色から選択可能：
- 赤、ピンク、紫、深紫
- 藍、青、水色、シアン
- ティール、緑、ライムグリーン、ライム
- 黄、アンバー、オレンジ、茶

### 複数PC間での同期
- タグデータは `tags.json` に保存されます
- イベントソーシング方式を採用
- 複数のPCで同じフォルダを編集しても競合なく同期されます
- 各操作がログとして記録され、時系列で統合されます

---

## 表編集機能

マークダウン形式の表をWYSIWYGエディタで簡単に作成・編集できます。

### 表の追加

1. エディタ内でカーソルを表を挿入したい位置に移動
2. エディタ上で右クリック
3. **表を追加** を選択
4. 表編集ダイアログが開きます（デフォルトは3列×3行）
5. 表の内容を編集
6. **保存** ボタンをクリック
7. マークダウン形式の表がカーソル位置に挿入されます

### 表の編集

1. カーソルを既存の表の行上に移動（`|`で始まる行）
2. エディタ上で右クリック
3. **表を編集** を選択
4. 表編集ダイアログが開き、既存の表データが読み込まれます
5. 表の内容を編集
6. **保存** ボタンをクリック
7. 元の表が更新されます

### 表編集ダイアログの操作

**ツールバー:**
- **+行(上)**: 選択した行の上に新しい行を追加
- **+行(下)**: 選択した行の下に新しい行を追加
- **行削除**: 選択した行を削除（最低2行は保持）
- **+列(左)**: 選択した列の左に新しい列を追加
- **+列(右)**: 選択した列の右に新しい列を追加
- **列削除**: 選択した列を削除（最低2列は保持）

**セルの編集:**
- セルをクリックして内容を編集
- **Enter** キーを押すとセル内で改行できます
- 改行はマークダウンでは `<br>` タグとして保存されます
- プレビューでも正しく改行として表示されます

**列の配置設定:**
- ヘッダー行の下に配置ボタンが表示されます
- **◀** (左寄せ)、**■** (中央揃え)、**▶** (右寄せ) から選択
- 配置は列全体に適用されます
- マークダウンの区切り行に反映されます（`:---:`, `---:`）

**行・列の選択:**
- セルをクリックすると、その行が選択状態になります
- ヘッダーセルをクリックすると、その列が選択状態になります

**保存:**
- **保存** ボタンをクリックすると、編集内容がマークダウン形式に変換されてエディタに挿入されます
- **キャンセル** ボタンをクリックすると、変更を破棄してダイアログを閉じます

### マークダウン形式

表は標準的なマークダウン形式で保存されます：

```markdown
| ヘッダー1 | ヘッダー2 | ヘッダー3 |
| --- | :---: | ---: |
| 左寄せ | 中央揃え | 右寄せ |
| データ1 | データ2<br>改行あり | データ3 |
```

**配置記法:**
- `---`: 左寄せ（デフォルト）
- `:---:`: 中央揃え
- `---:`: 右寄せ

**改行記法:**
- セル内の改行は `<br>` タグで表現
- プレビューで正しく改行として表示されます

### プレビューでの表示

- マークダウンプレビュー機能で表を確認できます
- 配置設定（左/中央/右）が正しく反映されます
- セル内の改行（`<br>`）も正しく表示されます
- 表はHTMLの `<table>` タグとしてレンダリングされます

### 制限事項

- 表の最小サイズは2列×2行です（1ヘッダー行 + 1データ行）
- 最大サイズの制限はありませんが、大きすぎる表は編集しにくい場合があります

---

## 設定とカスタマイズ

### 設定画面の構成
設定画面は3つのタブで構成されています：

**全般タブ**
- **作業フォルダ**: メモ保存先フォルダの選択

**エディタタブ**
- **キーバインド**: 標準、Vim、Emacs、Sublime、VSCode から選択
- **テーマ1**: メインテーマの選択（7種類以上のACEエディターテーマ）
- **テーマ2**: サブテーマの選択（🎨ボタンでテーマ1と切り替え）
- **フォントサイズ**: 10〜30pxで調整可能
- **折り返し表示**: 長い行の折り返し表示をオン/オフ
- **行番号を表示**: エディタの行番号表示をオン/オフ

**タグタブ**
- **タグ検索**: タグ名で検索、Enterキーで新規作成
- **タグ一覧**: 全タグをリスト表示、ドラッグ&ドロップで並べ替え
- **編集・削除**: 各タグの右側にボタンを配置、クリックで操作

### テーマシステム
- ACEエディターのテーマ選択
- アプリ全体の色がエディターテーマに自動連動
- 対応テーマ: Monokai, GitHub, Tomorrow, Twilight, Solarized, Dracula など

### マークダウンプレビュー
エディタヘッダーのプレビューボタン（👁️アイコン）をクリックすると、別ウィンドウでプレビューが表示されます。

**対応する記法:**
- **見出し**: `#` から `######` まで（h1-h6）
- **太字**: `**太字**` または `__太字__`
- **斜体**: `*斜体*` または `_斜体_`
- **取消線**: `~~取消線~~`
- **箇条書き**: `-` または `*` で開始（ネスト対応）
- **番号付きリスト**: `1.` で開始（ネスト対応）
- **コードブロック**: \`\`\` で囲む（余計な改行なし）
- **インラインコード**: \` で囲む
- **引用**: `>` で開始（複数行の統合処理）
- **表**: パイプ区切り（`| ヘッダー1 | ヘッダー2 |`）、配置指定（`:---:`、`---:`）、セル内改行（`<br>`）に対応
- **水平線**: `---` または `****`
- **リンク**: `[テキスト](URL)`
- **画像**: `![代替テキスト](URL)`

**プレビューコントロール:**
- **テーマ切り替え**: ライトモード/ダークモードの切り替え
- **印刷**: プレビュー内容を印刷
- **ズーム**: 縮小/等倍/拡大の切り替え
- **再読み込み**: 現在のアクティブタブから内容を再取得

### UIアイコン
アプリ全体でMaterial Symbolsアイコンを使用しています：
- **folder**: ワークスペース選択
- **search**: 検索ボックス
- **preview**: マークダウンプレビュー
- **routine**: テーマ切り替え
- **space_bar**: 空白文字表示切り替え
- **text_decrease**: フォントサイズ縮小
- **text_increase**: フォントサイズ拡大
- **settings**: 設定
- **sell**: タグフィルター/タグアイコン
- **draft**: タグなし文書
- **docs**: タグあり文書

すべてのアイコンは現在のテーマに応じて自動的に色が調整されます。

### 設定の保存
- 設定変更は即座に保存
- 設定ファイル: `settings.json`
- アプリ再起動は不要

---

## コンテキストメニュー

### ファイルリストでの右クリック
- **タグを編集**: ファイルにタグを付けたり外したりする（ファイルヘッダーの🏷️アイコンからも可能）
- **ファイル名更新**: 内容に基づく自動リネーム
- **削除**: 確認付きファイル削除

### ステータスバーでの右クリック
- **開発者ツール**: 別ウィンドウで開発者ツールを表示

### エディターでの右クリック
- **URLを開く**: URL上で右クリックしてブラウザーで開く
- **Googleで検索**: 選択テキストをGoogleで検索
- **標準編集機能**: コピー、カット、ペーストなど
- **箇条書き操作**:
  - **箇条書き(-)にする**: 選択行の先頭に「- 」を追加（先頭空白保持）
  - **箇条書き(1)にする**: 選択行の先頭に「1. 」を追加（先頭空白保持）
  - **箇条書きをやめる**: 「- 」「* 」「1. 」を削除
  - 全操作でUndo/Redo完全対応
- **表操作**:
  - **表を追加**: カーソル位置に新しい3×3の表を挿入
  - **表を編集**: カーソルが表の行上にある場合に表示され、既存の表を編集

### スマートポジショニング
- コンテキストメニューは画面端で自動位置調整
- 常に画面内に表示されます

---

## キーボードショートカット

### 標準ショートカット
- **Ctrl+C / Cmd+C**: コピー
- **Ctrl+X / Cmd+X**: カット
- **Ctrl+V / Cmd+V**: ペースト
- **Ctrl+Z / Cmd+Z**: 元に戻す
- **Ctrl+Y / Cmd+Y**: やり直し

### Emacsキーバインド（設定で有効化時）
- **Ctrl+W**: カット
- **Alt+W**: コピー
- **Ctrl+Y**: ペースト
- **Ctrl+S**: 検索開始/次の候補
- **Ctrl+R**: 前の検索候補
- **Ctrl+G**: 検索終了

### 箇条書きのショートカット
- **Tab**: 箇条書き行でインデントを増やす（2スペース追加）
- **Shift+Tab**: 箇条書き行でインデントを減らす（2スペース削除）
- 対応する箇条書き形式: 「- 」「* 」「1. 」など

### その他のショートカット
- **Cmd+N (macOS)**: 新しいタブを作成

### システムクリップボード連携
- 他のアプリケーションとの完全なクリップボード同期
- Windows、macOS、Linux 対応
- 複数層のクリップボード処理で確実な動作

---

## セッション復元

### 自動復元機能
- アプリ起動時に前回のセッション状態を自動復元
- 各ワークスペースごとに独立したセッションを保持
- 開いていたタブとアクティブタブを復元
- ファイル内容と編集状態も復元

### セッション管理
- タブ操作の度に自動的にセッション状態を保存
- ワークスペース切り替え時に現在のセッションを保存
- ファイルが削除された場合は対応するタブも除外
- セッションファイル: `sessions.json`（ワークスペースごと）

### 復元される情報
- 開いていたファイルのタブ（ワークスペースごと）
- アクティブなタブ（ワークスペースごと）
- エディターの状態
- ファイルの内容
- ワークスペースの選択状態

---

## データ管理

### 保存場所
- **メモファイル**: 各ワークスペースのルートフォルダー内
- **ワークスペース設定**: `workspace.json`（version 2.0形式、ワークスペースリストとアクティブワークスペース）
- **エディター設定**: `settings.json`
- **セッション状態**: `sessions.json`（ワークスペースごとのセッション）
- **タグデータ**: `tags.json`（各ワークスペースのルートフォルダー内、イベントソーシング形式）

### ファイル監視
- chokidar を使用したリアルタイムファイル監視
- 外部での変更を自動検出
- ファイルリストの自動更新
- 一時ファイル（~、.swp、.、.DS_Store、.tmp）は自動除外

---

## トラブルシューティング

### よくある問題

**ファイルが表示されない**
- ルートフォルダーの設定を確認
- `.md` または `.txt` 拡張子のファイルのみ表示

**タブが復元されない**
- 対象ファイルが存在するか確認
- セッションファイルの破損の可能性

**検索が動作しない**
- ファイルへの読み取り権限を確認
- 検索対象フォルダーのアクセス権限を確認

**テーマが適用されない**
- 設定の再読み込み
- アプリの再起動

### 開発者ツール
- ステータスバーを右クリック → **開発者ツール**
- コンソールでエラーログを確認可能

---

## システム要件
- **Electron**: 37.4.0
- **ACE Editor**: 1.43.2
- **File Watcher**: chokidar 4.0.3
- **Icons**: Material Symbols (material-symbols)
- **対応OS**: Windows, macOS, Linux

---

## 更新履歴

### 最新版
- **表編集機能**: マークダウン表のWYSIWYG編集をモーダルダイアログで実装
  - 新規表の追加（デフォルト3×3）と既存表の編集
  - 行・列の追加・削除、セル内改行対応（Enterキー）
  - 列ごとの配置設定（左/中央/右）
  - プレビューで配置と改行を正しく表示
- **設定画面のタブ化**: 全般、エディタ、タグの3つのタブで設定を整理
- **タグ管理の強化**: 設定画面のタグタブでタグの作成、編集、削除、並べ替えが可能
- **タグ順序の統一**: ファイルヘッダーのバッジ、タグフィルター、ファイルアイコンの色が同じ順序で表示
- **ファイルヘッダーのタグ表示**: ファイル名の後ろにタグバッジを表示、🏷️アイコンで編集
- **ファイルアイコンの色**: タグありファイルのアイコンが先頭タグの色で表示
- **タグフィルタークリアボタン**: 全フィルタを一括リセットする「クリア」ボタンを追加
- **タグダイアログの簡素化**: タイトルとファイル名表示を削除、検索ボックス、タグリスト、閉じるボタンのみ

### 以前のバージョン
- **タグ管理機能**: 16色のカラータグでファイルを分類、3状態フィルタリング、イベントソーシング方式で複数PC間の同期に対応
- **Material Symbols**: タグアイコンなどに Material Symbols を採用、一貫性のあるアイコンデザイン
- **検索とタグの統合**: テキスト検索とタグフィルタを組み合わせて使用可能

### 以前のバージョン
- **検索機能の強化**: マッチしたテキストスニペットと行番号を表示、クリックで該当行へジャンプ
- **箇条書きインデント**: TabキーとShift+Tabで箇条書き行のインデント調整が可能
- **ワークスペース管理**: 複数のプロジェクトフォルダーを管理、ワークスペースごとに独立したセッション
- **ビルド機能拡張**: `npm run build-all`で macOS（arm64/x64）と Windows（x64）を一度にビルド可能

### 以前のバージョン
- 完全なセッション復元とクリップボード統合を実装
- ドラッグ&ドロップによるタブ並び替え機能を追加
- スマートなファイル作成とリアルタイムファイル監視を実装
- IME対応自動保存機能を追加（日本語入力時の文字消失を防止）